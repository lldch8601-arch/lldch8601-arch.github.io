// 格式化时间工具函数
function formatTime() {
    const now = new Date();
    return now.toLocaleString("zh-CN", {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
}

// 新增：图片链接压缩函数（核心优化）
function optimizeAmazonImageUrl(originalUrl) {
    if (!originalUrl || !originalUrl.includes("amazon.com/images/")) {
        return originalUrl;
    }
    // SL800：长边800像素（推荐），体积比SL1500小60%左右，视觉依然高清
    return originalUrl.replace("_AC_SL1500_", "_AC_SL800_");
}

// 懒加载初始化（仅渲染当前页的图片）
function initLazyLoad() {
    // 原有代码不变...
}

// 渲染指定页的数据（核心优化：分页渲染）
function renderPageData(pageNum) {
    const startIndex = (pageNum - 1) * PAGE_SIZE;
    const endIndex = pageNum * PAGE_SIZE;
    const pageData = totalData.slice(startIndex, endIndex);

    if (pageData.length === 0) {
        hasMore = false;
        document.getElementById('loadMoreTip').textContent = '没有更多数据了';
        return;
    }

    const containerEl = document.getElementById('product-container');
    pageData.forEach(product => {
        // 关键修改：压缩图片链接
        const originalImgSrc = product.first_image_url || "";
        const imgSrc = optimizeAmazonImageUrl(originalImgSrc); // 调用压缩函数
        
        const searchKeyword = product.search_keyword || "未知关键词";
        // 其余代码不变...

        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
            <img 
                class="product-img" 
                data-src="${imgSrc}" // 用压缩后的链接
                src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                alt="${searchKeyword}"
                data-alt="${searchKeyword}"
            >
            // 其余HTML不变...
        `;
        containerEl.appendChild(card);
    });

    initLazyLoad();
    isLoading = false;
    document.getElementById('loadMoreTip').textContent = '上拉加载更多';
}
